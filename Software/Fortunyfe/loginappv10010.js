var app=angular.module("HIS",["ngRoute","kendo.directives","ngCookies","globalErrors","ngResource","HIS.Login","HIS.AprobacionesExternas"]);app.config(["$provide","$httpProvider","$compileProvider",function(o,e,r){$()}]),app.config(["$routeProvider",function(o){o.when("/",{templateUrl:"js/app/Login/loginView.html",controller:"loginController"}).when("/aprobacionesExternas/:tokenjwt/:entidad/:idEntidad/:idUsuario/:idSolicitud/:estado",{templateUrl:"js/app/AprobacionesExternas/aprobacionesExternasView.html",controller:"AprobacionesExternasController"}).when("/recuperarClave",{templateUrl:"js/app/Login/recuperarPasswordView.html",controller:"recupPassController"}).when("/recuperarClave/nuevaContrasenia/:idUsuario",{templateUrl:"js/app/Login/cambiarPassView.html",controller:"nuevoPasswordController"})}]);var HISLogin=angular.module("HIS.Login",[]);HISLogin.value("startPage","welcome.html"),HISLogin.controller("loginController",["$cookieStore","$scope","Session","startPage",function(o,e,r,t){var a=o.get("tokenActual");null==a?(e.erroresLoggin="",e.mismoValor=!1,e.formData={},e.cerrarPupUp=function(){$("#popupDatosIncorrectos").modal("hide")},e.submitForm=function(o){if(e.submitted=!0,o){var a={alg:"HS256",typ:"JWT"},n={},i=(KJUR.jws.IntDate.get("now"),KJUR.jws.IntDate.get("now + 1day"));n.iss="http://localhost",n.sub="http://localhost",n.exp=i,n.usuario=e.formData.usuario,n.contrasena=e.formData.password,n.latitud="10",n.longitud="20",n.jti="id123456",n.aud="http://localhost";var s=JSON.stringify(a),l=JSON.stringify(n),c=KJUR.jws.JWS.sign(null,s,l,"Vbxq2mlbGJw8XH+ZoYBnUHmHga8/o/IduvU/Tht70iE=");e.token={},e.token.jwt=c;var u={};u.Token=localStorage[c],r.authUser().save(e.token).$promise.then(function(o){var e=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(o.JWT.split(".")[1]));0!=e.idUsuario&&($tokenInicio=o.JWT,localStorage.setItem("sJWT",o.JWT),window.location=t),"000000"==o.Code&&(localStorage.Token=e.token,$window.location.reload())},function(o){o.status;e.mostrarMensajeError=o.data.err,r.logginPswdIncorrecto()})}}):window.location=t}]),HISLogin.controller("recupPassController",["$scope","Session","startPage",function(o,e,r){o.formData={},o.enviarUsuario=function(r){o.submitted=!0,r&&e.recuperarPassword().recupPassword({correo:o.formData.usuario},function(o){e.mensajeEnvioEmail(function(o){window.location="/#/"})},function(o){})},o.cerrarPupUp=function(){$("#popupEnvioEmail").modal("hide")}}]),HISLogin.controller("nuevoPasswordController",["$scope","Session","startPage","$routeParams",function(o,e,r,t){o.token=t.idUsuario,localStorage.setItem("sJWT",o.token),o.formData={},o.cambiarClaveUsuario=function(r,t){if(o.submitted=!0,t)if(o.formData.nuevaClave==o.formData.repitaNuevaClave){var a={alg:"HS256",typ:"JWT"},n={},i=(KJUR.jws.IntDate.get("now"),KJUR.jws.IntDate.get("now + 1day"));n.iss="http://157.245.86.94",n.sub="http://157.245.86.94",n.exp=i,n.claveNueva=o.formData.nuevaClave,n.jti="id123456",n.aud="http://157.245.86.94";var s=JSON.stringify(a),l=JSON.stringify(n),c=KJUR.jws.JWS.sign(null,s,l,"Vbxq2mlbGJw8XH+ZoYBnUHmHga8/o/IduvU/Tht70iE=");o.clave=c,e.CambiarPswd().nuevoPassword({jwt:o.clave},function(o){e.mensajeUpdate(function(o){window.location="/#/"})},function(o){})}else $("#contraseniasDesiguales").modal("show")},o.cerrarPupUp=function(){$("#popupMensajesUpdate").modal("hide"),$("#contraseniasDesiguales").modal("hide")}}]),HISLogin.directive("popupEnvioEmail",function(){return{restrict:"E",templateUrl:"js/app/Shared/popUpMensajeEmail.html"}}),HISLogin.directive("mensajeUpdateData",function(){return{restrict:"E",templateUrl:"js/app/Shared/popUpMensajeUpdate.html"}}),HISLogin.directive("pwdIncorrecto",function(){return{restrict:"E",templateUrl:"js/app/Shared/popUpLogginPwdIncorrecto.html"}}),HISLogin.directive("mensajeError404",function(){return{restrict:"E",templateUrl:"js/app/Shared/popUps/popUpError404.html"}});var globalErrors=new angular.module("globalErrors",[]).config(["$provide","$httpProvider","$compileProvider",function(o,e,r){$();console.log("Aism");var t=function(o,e){$("#mensajeError").text(e),$("#popupErroresGlobales").modal("show"),setTimeout(function(){$("#popupErroresGlobales").modal("hide")},2200)};e.interceptors.push(["$q",function(o){return{responseError:function(e){return console.log("Mole"),console.log(e),t(e.data,e.data.message),o.reject(e)}}}])}]);HISLogin.factory("Session",["$resource","$cookieStore",function(o,e){var r="http://localhost:8052";localStorage.getItem("sJWT");return{urlBase:function(){return r},authUser:function(){return o(r+"/HS_Autenticar",{},{update:{method:"PUT"}})},recuperarPassword:function(){return o(r+"/HS_Usuario/:id",{id:"@_id"},{recupPassword:{url:r+"/HS_Usuario/recuperarPswd",method:"POST"}})},CambiarPswd:function(){return o(r+"/HS_Usuario/:id",{id:"@_id"},{nuevoPassword:{url:r+"/HS_Usuario/nuevoPswd",method:"POST",headers:{Authorization:"Basic "+Base64.encode(localStorage.getItem("sJWT"))}}})},mensajeEnvioEmail:function(o){$("#popupEnvioEmail").modal("show"),setTimeout(function(){$("#popupEnvioEmail").modal("hide"),setTimeout(function(){return o(200)},800)},2e3)},mensajeUpdate:function(o){$("#popupMensajesUpdate").modal("show"),setTimeout(function(){$("#popupMensajesUpdate").modal("hide"),setTimeout(function(){return o(200)},800)},2e3)},logginPswdIncorrecto:function(){$("#popupDatosIncorrectos").modal("show"),setTimeout(function(){$("#popupDatosIncorrectos").modal("hide")},3e3)}}}]);var HISAprobacionesExternas=angular.module("HIS.AprobacionesExternas",[]);HISAprobacionesExternas.controller("AprobacionesExternasController",["$scope","$rootScope","$routeParams","AprobacionesExternasService",function(o,e,r,t){o.razonRechazo=" ",o.solitudRespondida=!1,o.tipoRespuesta="Aprobada",o.solitudEnProceso=!1,o.solitudErronea=!1,o.errorRazonRechazo=!1,o.ingresarRazonRechazo=!1,0==r.estado&&(o.ingresarRazonRechazo=!0),o.solicitudAprobacion=function(e){o.solitudEnProceso=!0;var a={entidad:r.entidad,idEntidad:r.idEntidad,idUsuario:r.idUsuario,idSolicitud:r.idSolicitud,estado:r.estado};""!=e&&0==r.estado&&(a.razonRechazo=e),localStorage.setItem("sJWTExterno",r.tokenjwt),t.responderSolicitud().save(a,function(){o.solitudEnProceso=!1,o.solitudRespondida=!0,o.errorRazonRechazo=!1,o.ingresarRazonRechazo=!1,localStorage.removeItem("sJWTExterno")},function(e){console.log(e),o.errorRespuesta=e.data.message,o.solitudErronea=!0,o.solitudEnProceso=!1,o.errorRazonRechazo=!1,o.ingresarRazonRechazo=!1,localStorage.removeItem("sJWTExterno")})},1==r.estado&&o.solicitudAprobacion(""),o.rechazarSolicitud=function(e){" "!=e&&""!=e&&e?(o.tipoRespuesta="Rechazada",o.solicitudAprobacion(e)):o.errorRazonRechazo=!0}}]),HISAprobacionesExternas.factory("AprobacionesExternasService",["$resource","$q","$http","Session",function(o,e,r,t){return{responderSolicitud:function(){return o(t.urlBase()+"/aprobacionesExternas/:id",{id:"@_id"},{save:{method:"POST",headers:{Authorization:"Basic "+Base64.encode(localStorage.getItem("sJWTExterno"))}}})}}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2luYXBwLmpzIiwibG9naW4ubW9kdWxlLmpzIiwibG9naW5Db250cm9sbGVyLmpzIiwibG9naW5EaXJlY3RpdmUuanMiLCJsb2dpbkVycm9ycy5qcyIsImxvZ2luU2VydmljZS5qcyIsImFwcm9iYWNpb25lc0V4dGVybmFzLm1vZHVsZS5qcyIsImFwcm9iYWNpb25lc0V4dGVybmFzQ29udHJvbGxlci5qcyIsImFwcm9iYWNpb25lc0V4dGVybmFzU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHByb3ZpZGUiLCIkaHR0cFByb3ZpZGVyIiwiJGNvbXBpbGVQcm92aWRlciIsIiQiLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJISVNMb2dpbiIsInZhbHVlIiwiJGNvb2tpZVN0b3JlIiwiJHNjb3BlIiwiU2Vzc2lvbiIsInN0YXJ0UGFnZSIsInZlcmlmaWNhbmRvQ29va2llIiwiZ2V0IiwiZXJyb3Jlc0xvZ2dpbiIsIm1pc21vVmFsb3IiLCJmb3JtRGF0YSIsImNlcnJhclB1cFVwIiwibW9kYWwiLCJzdWJtaXRGb3JtIiwiaXNWYWxpZCIsInN1Ym1pdHRlZCIsIm9IZWFkZXIiLCJhbGciLCJ0eXAiLCJvUGF5bG9hZCIsInRFbmQiLCJLSlVSIiwiandzIiwiSW50RGF0ZSIsImlzcyIsInN1YiIsImV4cCIsInVzdWFyaW8iLCJjb250cmFzZW5hIiwicGFzc3dvcmQiLCJsYXRpdHVkIiwibG9uZ2l0dWQiLCJqdGkiLCJhdWQiLCJzSGVhZGVyIiwiSlNPTiIsInN0cmluZ2lmeSIsInNQYXlsb2FkIiwic0pXVCIsIkpXUyIsInNpZ24iLCJ0b2tlbiIsImp3dCIsInBhcmFtIiwiVG9rZW4iLCJsb2NhbFN0b3JhZ2UiLCJhdXRoVXNlciIsInNhdmUiLCIkcHJvbWlzZSIsInRoZW4iLCJyZXNwb25zZU1lc3NhZ2UiLCJwYXlsb2FkT2JqIiwicmVhZFNhZmVKU09OU3RyaW5nIiwiYjY0dXRvdXRmOCIsIkpXVCIsInNwbGl0IiwiaWRVc3VhcmlvIiwiJHRva2VuSW5pY2lvIiwic2V0SXRlbSIsIndpbmRvdyIsImxvY2F0aW9uIiwiQ29kZSIsIiR3aW5kb3ciLCJyZWxvYWQiLCJlcnJvciIsInN0YXR1cyIsIm1vc3RyYXJNZW5zYWplRXJyb3IiLCJkYXRhIiwiZXJyIiwibG9nZ2luUHN3ZEluY29ycmVjdG8iLCJlbnZpYXJVc3VhcmlvIiwicmVjdXBlcmFyUGFzc3dvcmQiLCJyZWN1cFBhc3N3b3JkIiwiY29ycmVvIiwicmVzdWx0IiwibWVuc2FqZUVudmlvRW1haWwiLCJjYiIsIiRyb3V0ZVBhcmFtcyIsImNhbWJpYXJDbGF2ZVVzdWFyaW8iLCJudWV2YUNsYXZlIiwicmVwaXRhTnVldmFDbGF2ZSIsImNsYXZlTnVldmEiLCJjbGF2ZSIsIkNhbWJpYXJQc3dkIiwibnVldm9QYXNzd29yZCIsIm1lbnNhamVVcGRhdGUiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImdsb2JhbEVycm9ycyIsImNvbnNvbGUiLCJsb2ciLCJzaG93TWVzc2FnZSIsIm1lbnNhamUiLCJ0ZXh0Iiwic2V0VGltZW91dCIsImludGVyY2VwdG9ycyIsInB1c2giLCIkcSIsInJlc3BvbnNlRXJyb3IiLCJyZWplY3Rpb24iLCJtZXNzYWdlIiwicmVqZWN0IiwiZmFjdG9yeSIsIiRyZXNvdXJjZSIsInNlcnZpY2lvc0Jhc2UiLCJnZXRJdGVtIiwidXJsQmFzZSIsInVwZGF0ZSIsIm1ldGhvZCIsImlkIiwidXJsIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJCYXNlNjQiLCJlbmNvZGUiLCJISVNBcHJvYmFjaW9uZXNFeHRlcm5hcyIsIiRyb290U2NvcGUiLCJBcHJvYmFjaW9uZXNFeHRlcm5hc1NlcnZpY2UiLCJyYXpvblJlY2hhem8iLCJzb2xpdHVkUmVzcG9uZGlkYSIsInRpcG9SZXNwdWVzdGEiLCJzb2xpdHVkRW5Qcm9jZXNvIiwic29saXR1ZEVycm9uZWEiLCJlcnJvclJhem9uUmVjaGF6byIsImluZ3Jlc2FyUmF6b25SZWNoYXpvIiwiZXN0YWRvIiwic29saWNpdHVkQXByb2JhY2lvbiIsInRleHRvUmVjaGF6byIsImRhdG9zU29saWNpdHVkQXByb2JhY2lvbiIsImVudGlkYWQiLCJpZEVudGlkYWQiLCJpZFNvbGljaXR1ZCIsInRva2Vuand0IiwicmVzcG9uZGVyU29saWNpdHVkIiwicmVtb3ZlSXRlbSIsInJlc3BvbnNlIiwiZXJyb3JSZXNwdWVzdGEiLCJyZWNoYXphclNvbGljaXR1ZCIsIiRodHRwIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLE9BQUEsVUFFQSxtQkFDQSxZQUNBLGVBQ0EsYUFDQSxZQUNBLDRCQUtBRixLQUFBRyxRQUFBLFdBQUEsZ0JBQUEsbUJBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQUMsT0FNQVAsSUFBQUcsUUFBQSxpQkFBQSxTQUFBSyxHQUVBQSxFQUNBQyxLQUFBLEtBQ0FDLFlBQUEsOEJBQ0FDLFdBQUEsb0JBRUFGLEtBQUEsdUZBQ0FDLFlBQUEsNERBQ0FDLFdBQUEsbUNBRUFGLEtBQUEsbUJBQ0FDLFlBQUEsMENBQ0FDLFdBQUEsd0JBRUFGLEtBQUEsK0NBQ0FDLFlBQUEsb0NBQ0FDLFdBQUEsOEJDcENBLElBQUFDLFVBQUFYLFFBQUFDLE9BQUEsZUFDQVUsVUFBQUMsTUFBQSxZQUFBLFlDREFELFNBQ0FELFdBQUEsbUJBQUEsZUFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBRyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBLEdBQUFDLEdBQUFKLEVBQUFLLElBQUEsY0FDQSxPQUFBRCxHQUlBSCxFQUFBSyxjQUFBLEdBQ0FMLEVBQUFNLFlBQUEsRUFFQU4sRUFBQU8sWUFJQVAsRUFBQVEsWUFBQSxXQUNBaEIsRUFBQSwwQkFBQWlCLE1BQUEsU0FFQVQsRUFBQVUsV0FBQSxTQUFBQyxHQUdBLEdBREFYLEVBQUFZLFdBQUEsRUFDQUQsRUFBQSxDQUVBLEdBQUFFLElBQUFDLElBQUEsUUFBQUMsSUFBQSxPQUNBQyxLQUVBQyxHQURB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QU4sT0FBQWhELEVBQUFnRCxPQUdBLEtBQUFFLEdBQUEsR0FBQWxELEVBQUFnRCxTQUdBRyxFQUFBVixhQUFBUyxHQUdBbEYsYUFBQWEsUUFBQSxjQUFBbUIsRUFBQXVELFVBQ0FmLEVBQUFnQixxQkFBQXRGLEtBQUFpRixFQUFBLFdBQ0E3SCxFQUFBc0gsa0JBQUEsRUFDQXRILEVBQUFvSCxtQkFBQSxFQUVBcEgsRUFBQXdILG1CQUFBLEVBQ0F4SCxFQUFBeUgsc0JBQUEsRUFDQS9FLGFBQUF5RixXQUFBLGdCQUVBLFNBQUFDLEdBQ0E5QyxRQUFBQyxJQUFBNkMsR0FDQXBJLEVBQUFxSSxlQUFBRCxFQUFBcEUsS0FBQWlDLFFBQ0FqRyxFQUFBdUgsZ0JBQUEsRUFDQXZILEVBQUFzSCxrQkFBQSxFQUNBdEgsRUFBQXdILG1CQUFBLEVBQ0F4SCxFQUFBeUgsc0JBQUEsRUFDQS9FLGFBQUF5RixXQUFBLGtCQVFBLEdBQUF6RCxFQUFBZ0QsUUFFQTFILEVBQUEySCxvQkFBQSxJQUdBM0gsRUFBQXNJLGtCQUFBLFNBQUFWLEdBR0EsS0FBQUEsR0FBQSxJQUFBQSxHQUFBQSxHQUVBNUgsRUFBQXFILGNBQUEsWUFFQXJILEVBQUEySCxvQkFBQUMsSUFNQTVILEVBQUF3SCxtQkFBQSxNQzVFQVIsd0JBQUFiLFFBQUEsK0JBQUEsWUFBQSxLQUFBLFFBQUEsVUFBQSxTQUFBQyxFQUFBTixFQUFBeUMsRUFBQXRJLEdBQ0EsT0FDQWlJLG1CQUFBLFdBQ0EsTUFBQTlCLEdBQUFuRyxFQUFBc0csVUFBQSw2QkFBQUcsR0FBQSxTQUVBOUQsTUFBQTZELE9BQUEsT0FBQUcsU0FBQUMsY0FBQSxTQUFBQyxPQUFBQyxPQUFBckUsYUFBQTRELFFBQUEiLCJmaWxlIjoibG9naW5hcHB2MTAwMTAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ0hJUycsIFsnbmdSb3V0ZScsXG5cbiAgJ2tlbmRvLmRpcmVjdGl2ZXMnICxcbiAgJ25nQ29va2llcycsXG4gICdnbG9iYWxFcnJvcnMnLFxuICAnbmdSZXNvdXJjZScsICBcbiAgJ0hJUy5Mb2dpbicsXG4gICdISVMuQXByb2JhY2lvbmVzRXh0ZXJuYXMnXG4gIFxuICBdKVxuXG5cbmFwcC5jb25maWcoZnVuY3Rpb24oJHByb3ZpZGUsICRodHRwUHJvdmlkZXIsICRjb21waWxlUHJvdmlkZXIpIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzTGlzdCA9ICQoKTtcblxuICAgICAgXG4gICAgICB9KTtcblxuXG5hcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XG5cbiAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsIDogJ2pzL2FwcC9Mb2dpbi9sb2dpblZpZXcuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyICA6ICdsb2dpbkNvbnRyb2xsZXInXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvYXByb2JhY2lvbmVzRXh0ZXJuYXMvOnRva2Vuand0LzplbnRpZGFkLzppZEVudGlkYWQvOmlkVXN1YXJpby86aWRTb2xpY2l0dWQvOmVzdGFkbycsIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvYXBwL0Fwcm9iYWNpb25lc0V4dGVybmFzL2Fwcm9iYWNpb25lc0V4dGVybmFzVmlldy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBcHJvYmFjaW9uZXNFeHRlcm5hc0NvbnRyb2xsZXInXG4gICAgICAgIH0pXG4gICAgICAgICAud2hlbignL3JlY3VwZXJhckNsYXZlJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmwgOiAnanMvYXBwL0xvZ2luL3JlY3VwZXJhclBhc3N3b3JkVmlldy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgIDogJ3JlY3VwUGFzc0NvbnRyb2xsZXInXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvcmVjdXBlcmFyQ2xhdmUvbnVldmFDb250cmFzZW5pYS86aWRVc3VhcmlvJywge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmwgOiAnanMvYXBwL0xvZ2luL2NhbWJpYXJQYXNzVmlldy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgIDogJ251ZXZvUGFzc3dvcmRDb250cm9sbGVyJ1xuICAgICAgICB9KVxufV0pIiwidmFyIEhJU0xvZ2luID0gYW5ndWxhci5tb2R1bGUoJ0hJUy5Mb2dpbicsW10pO1xuSElTTG9naW4udmFsdWUoXCJzdGFydFBhZ2VcIixcImJ1eS5odG1sXCIpO1xuIiwiSElTTG9naW5cbi5jb250cm9sbGVyKCdsb2dpbkNvbnRyb2xsZXInLCBbJyRjb29raWVTdG9yZScsJyRzY29wZScsJ1Nlc3Npb24nLCdzdGFydFBhZ2UnLCBmdW5jdGlvbigkY29va2llU3RvcmUsJHNjb3BlLFNlc3Npb24sc3RhcnRQYWdlKXtcblxuICB2YXIgdmVyaWZpY2FuZG9Db29raWUgPSAkY29va2llU3RvcmUuZ2V0KCd0b2tlbkFjdHVhbCcpO1xuICBpZih2ZXJpZmljYW5kb0Nvb2tpZSA9PSBudWxsKVxuICB7XG4gICAgICAgXG5cbiAgICAgICAgICAgJHNjb3BlLmVycm9yZXNMb2dnaW49XCJcIjtcbiAgICAgICAgICAgJHNjb3BlLm1pc21vVmFsb3IgPSBmYWxzZTtcblxuICAgICAgICAgICAgICRzY29wZS5mb3JtRGF0YSA9IHtcblxuICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAkc2NvcGUuY2VycmFyUHVwVXA9ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQoJyNwb3B1cERhdG9zSW5jb3JyZWN0b3MnKS5tb2RhbCgnaGlkZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkc2NvcGUuc3VibWl0Rm9ybSA9IGZ1bmN0aW9uIChpc1ZhbGlkKSB7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAkc2NvcGUuc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICBpZiAoaXNWYWxpZCl7XG4gICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgb0hlYWRlciA9IHthbGc6ICdIUzI1NicsIHR5cDogJ0pXVCd9O1xuICAgICAgICAgICAgICAgIHZhciBvUGF5bG9hZCA9IHt9O1xuICAgICAgICAgICAgICAgIHZhciB0Tm93ID0gS0pVUi5qd3MuSW50RGF0ZS5nZXQoJ25vdycpO1xuICAgICAgICAgICAgICAgIHZhciB0RW5kID0gS0pVUi5qd3MuSW50RGF0ZS5nZXQoJ25vdyArIDFkYXknKTtcbiAgICAgICAgICAgICAgICBvUGF5bG9hZC5pc3MgPSBcImh0dHA6Ly9sb2NhbGhvc3RcIjtcbiAgICAgICAgICAgICAgICBvUGF5bG9hZC5zdWIgPSBcImh0dHA6Ly9sb2NhbGhvc3RcIjtcbiAgICAgICAgICAgICAgICBvUGF5bG9hZC5leHAgPSB0RW5kO1xuICAgICAgICAgICAgICAgIG9QYXlsb2FkLnVzdWFyaW8gPSAkc2NvcGUuZm9ybURhdGEudXN1YXJpbztcbiAgICAgICAgICAgICAgICBvUGF5bG9hZC5jb250cmFzZW5hID0gJHNjb3BlLmZvcm1EYXRhLnBhc3N3b3JkO1xuICAgICAgICAgICAgICAgIG9QYXlsb2FkLmxhdGl0dWQgPSAnMTAnO1xuICAgICAgICAgICAgICAgIG9QYXlsb2FkLmxvbmdpdHVkID0gJzIwJztcbiAgICAgICAgICAgICAgICBvUGF5bG9hZC5qdGkgPSBcImlkMTIzNDU2XCI7XG4gICAgICAgICAgICAgICAgb1BheWxvYWQuYXVkID0gXCJodHRwOi8vbG9jYWxob3N0XCI7XG5cblxuICAgICAgICAgICAgICAgIHZhciBzSGVhZGVyID0gSlNPTi5zdHJpbmdpZnkob0hlYWRlcik7XG4gICAgICAgICAgICAgICAgdmFyIHNQYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkob1BheWxvYWQpO1xuICAgICAgICAgICAgICAgIHZhciBzSldUICA9IEtKVVIuandzLkpXUy5zaWduKG51bGwsIHNIZWFkZXIsIHNQYXlsb2FkLCBcIlZieHEybWxiR0p3OFhIK1pvWUJuVUhtSGdhOC9vL0lkdXZVL1RodDcwaUU9XCIpO1xuICAgICAgICAgICAgICAgICRzY29wZS50b2tlbj0ge307XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRva2VuLmp3dD0gc0pXVDtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW09e31cbiAgICAgICAgICAgICAgICBwYXJhbS5Ub2tlbj1sb2NhbFN0b3JhZ2Vbc0pXVF07XG5cblxuICAgICAgICAgICAgICAgIFNlc3Npb24uYXV0aFVzZXIoKS5zYXZlKCRzY29wZS50b2tlbikuJHByb21pc2UudGhlbihmdW5jdGlvbihyZXNwb25zZU1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZE9iaiA9IEtKVVIuandzLkpXUy5yZWFkU2FmZUpTT05TdHJpbmcoYjY0dXRvdXRmOChyZXNwb25zZU1lc3NhZ2UuSldULnNwbGl0KFwiLlwiKVsxXSkpO1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkT2JqLmlkVXN1YXJpbyAhPSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0b2tlbkluaWNpbyA9IHJlc3BvbnNlTWVzc2FnZS5KV1Q7IFxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NKV1QnLCByZXNwb25zZU1lc3NhZ2UuSldUKTsgXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb249IHN0YXJ0UGFnZTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZU1lc3NhZ2UuQ29kZT09XCIwMDAwMDBcIil7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VbXCJUb2tlblwiXT1wYXlsb2FkT2JqLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgIH0sZnVuY3Rpb24oZXJyb3Ipe1xuXG4gICAgICAgICAgIFxuXG4gICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBlcnJvci5zdGF0dXM7XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAkc2NvcGUubW9zdHJhck1lbnNhamVFcnJvcj1lcnJvci5kYXRhLmVyclxuICAgICAgICAgICAgICAgICBTZXNzaW9uLmxvZ2dpblBzd2RJbmNvcnJlY3RvKCk7XG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIH0pOyBcblxuICAgICAgICAgfWVsc2V7XG5cblxuICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICBcbiAgICAgICAgIH07XG5cblxuICB9ZWxzZXtcbiAgICAgICAgIHdpbmRvdy5sb2NhdGlvbj0gc3RhcnRQYWdlO1xuICAgICAgfSAgXG5cblxufV0pXG5cbkhJU0xvZ2luLmNvbnRyb2xsZXIoJ3JlY3VwUGFzc0NvbnRyb2xsZXInLCBbJyRzY29wZScsJ1Nlc3Npb24nLCdzdGFydFBhZ2UnLCBmdW5jdGlvbigkc2NvcGUsU2Vzc2lvbixzdGFydFBhZ2Upe1xuICAgICRzY29wZS5mb3JtRGF0YT17fVxuICAgICRzY29wZS5lbnZpYXJVc3VhcmlvID0gZnVuY3Rpb24gKGlzVmFsaWQpIFxuICAgIHtcbiAgICAgICAgICRzY29wZS5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgIGlmIChpc1ZhbGlkKXtcblxuICAgICAgICAgIFNlc3Npb24ucmVjdXBlcmFyUGFzc3dvcmQoKS5yZWN1cFBhc3N3b3JkKHtjb3JyZW86JHNjb3BlLmZvcm1EYXRhLnVzdWFyaW99LCBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICBTZXNzaW9uLm1lbnNhamVFbnZpb0VtYWlsKGZ1bmN0aW9uKGNiKXtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbj0gXCIvIy9cIjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAgXG4gICAgICAgICAgfSxmdW5jdGlvbiAoZXJyb3Ipe1xuXG4gICAgICB9KTtcbiAgICAgICAgfVxuICAgXG4gICAgfVxuICAgICAkc2NvcGUuY2VycmFyUHVwVXA9ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQoJyNwb3B1cEVudmlvRW1haWwnKS5tb2RhbCgnaGlkZScpO1xuICAgIH1cblxufV0pXG5ISVNMb2dpbi5jb250cm9sbGVyKCdudWV2b1Bhc3N3b3JkQ29udHJvbGxlcicsIFsnJHNjb3BlJywnU2Vzc2lvbicsJ3N0YXJ0UGFnZScsJyRyb3V0ZVBhcmFtcycsIGZ1bmN0aW9uKCRzY29wZSxTZXNzaW9uLHN0YXJ0UGFnZSwkcm91dGVQYXJhbXMpe1xuIFxuICAkc2NvcGUudG9rZW49ICRyb3V0ZVBhcmFtcy5pZFVzdWFyaW87XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzSldUJywgJHNjb3BlLnRva2VuKTsgXG4gICRzY29wZS5mb3JtRGF0YT17fVxuICAkc2NvcGUuY2FtYmlhckNsYXZlVXN1YXJpbz1mdW5jdGlvbihmb3JtRGF0YSxpc1ZhbGlkKXtcbiAgICAkc2NvcGUuc3VibWl0dGVkPXRydWVcbiAgICBcbiAgICBpZihpc1ZhbGlkKVxuICAgIHsgIFxuICAgICAgIGlmKCRzY29wZS5mb3JtRGF0YS5udWV2YUNsYXZlID09ICRzY29wZS5mb3JtRGF0YS5yZXBpdGFOdWV2YUNsYXZlKVxuICAgICAgICAgIHtcblxuICAgICAgICAgICAgdmFyIG9IZWFkZXIgPSB7YWxnOiAnSFMyNTYnLCB0eXA6ICdKV1QnfTtcbiAgICAgICAgICAgICAgICB2YXIgb1BheWxvYWQgPSB7fTtcbiAgICAgICAgICAgICAgICB2YXIgdE5vdyA9IEtKVVIuandzLkludERhdGUuZ2V0KCdub3cnKTtcbiAgICAgICAgICAgICAgICB2YXIgdEVuZCA9IEtKVVIuandzLkludERhdGUuZ2V0KCdub3cgKyAxZGF5Jyk7XG4gICAgICAgICAgICAgICAgb1BheWxvYWQuaXNzID0gXCJodHRwOi8vbG9jYWxob3N0XCI7XG4gICAgICAgICAgICAgICAgb1BheWxvYWQuc3ViID0gXCJodHRwOi8vbG9jYWxob3N0XCI7XG4gICAgICAgICAgICAgICAgb1BheWxvYWQuZXhwID0gdEVuZDsgICAgICAgICAgXG4gICAgICAgICAgICAgICAgb1BheWxvYWQuY2xhdmVOdWV2YSA9ICRzY29wZS5mb3JtRGF0YS5udWV2YUNsYXZlO1xuICAgICAgICAgICAgICAgIG9QYXlsb2FkLmp0aSA9IFwiaWQxMjM0NTZcIjtcbiAgICAgICAgICAgICAgICBvUGF5bG9hZC5hdWQgPSBcImh0dHA6Ly9sb2NhbGhvc3RcIjtcbiAgICAgICAgICAgICAgICB2YXIgc0hlYWRlciA9IEpTT04uc3RyaW5naWZ5KG9IZWFkZXIpO1xuICAgICAgICAgICAgICAgIHZhciBzUGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KG9QYXlsb2FkKTtcbiAgICAgICAgICAgICAgICAgdmFyIHNKV1QgID0gS0pVUi5qd3MuSldTLnNpZ24obnVsbCwgc0hlYWRlciwgc1BheWxvYWQsIFwiVmJ4cTJtbGJHSnc4WEgrWm9ZQm5VSG1IZ2E4L28vSWR1dlUvVGh0NzBpRT1cIik7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNsYXZlPXNKV1Q7XG5cbiAgICAgICAgICAgICBTZXNzaW9uLkNhbWJpYXJQc3dkKCkubnVldm9QYXNzd29yZCh7and0OiRzY29wZS5jbGF2ZX0sIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgLy8gICAgICBQcm9maWxlU2VydmljZS5DYW1iaWFyUGFzc3dvcmQoKS51cGRhdGVQYXNzd29yZCh7aWQ6XCI1NjZmMjhmNzdjN2ZiNGU0MGQ2YzgxYjRcIn0se2p3dDokc2NvcGUuY2xhdmV9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBcbiAgICAgICAgICAgICAgICBTZXNzaW9uLm1lbnNhamVVcGRhdGUoZnVuY3Rpb24oY2IpeyAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbj0gXCIvIy9cIjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9LGZ1bmN0aW9uIChlcnJvcil7XG5cbiAgICAgICAgICAgICAgICAgIC8vICBlcnJvcmVzU2VydmljZXMuY29udHJvbEVycm9yKGVycm9yLnN0YXR1cyk7XG5cbiAgICAgICAgICAgICAgfSk7IFxuICAgICAgICAgICAgICAgXG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICB7XG4gICAgICAgICAgICAkKCcjY29udHJhc2VuaWFzRGVzaWd1YWxlcycpLm1vZGFsKCdzaG93JykgXG4gICAgICAgICAgICBcbiAgICAgICAgICB9XG5cbiAgICAgXG4gICAgfSBcblxuICB9XG4gICRzY29wZS5jZXJyYXJQdXBVcD1mdW5jdGlvbigpe1xuICAgIFxuICAgICAkKCcjcG9wdXBNZW5zYWplc1VwZGF0ZScpLm1vZGFsKCdoaWRlJyk7XG4gICAgICQoJyNjb250cmFzZW5pYXNEZXNpZ3VhbGVzJykubW9kYWwoJ2hpZGUnKTtcbiAgfVxuXG59XSkiLCJISVNMb2dpbi5kaXJlY3RpdmUoJ3BvcHVwRW52aW9FbWFpbCcsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgICB0ZW1wbGF0ZVVybCA6ICdqcy9hcHAvU2hhcmVkL3BvcFVwTWVuc2FqZUVtYWlsLmh0bWwnXG5cbiAgICB9O1xufSksXG5ISVNMb2dpbi5kaXJlY3RpdmUoJ21lbnNhamVVcGRhdGVEYXRhJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgIHRlbXBsYXRlVXJsIDogJ2pzL2FwcC9TaGFyZWQvcG9wVXBNZW5zYWplVXBkYXRlLmh0bWwnXG5cbiAgICB9O1xufSksXG5ISVNMb2dpbi5kaXJlY3RpdmUoJ3B3ZEluY29ycmVjdG8nLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgdGVtcGxhdGVVcmwgOiAnanMvYXBwL1NoYXJlZC9wb3BVcExvZ2dpblB3ZEluY29ycmVjdG8uaHRtbCdcblxuICAgIH07XG59KSxcblxuSElTTG9naW4uZGlyZWN0aXZlKCdtZW5zYWplRXJyb3I0MDQnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgdGVtcGxhdGVVcmwgOiAnanMvYXBwL1NoYXJlZC9wb3BVcHMvcG9wVXBFcnJvcjQwNC5odG1sJ1xuXG4gICAgfTtcbn0pIiwidmFyIGdsb2JhbEVycm9ycyA9IG5ldyBhbmd1bGFyXG4gICAgLm1vZHVsZSgnZ2xvYmFsRXJyb3JzJywgW10pXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkcHJvdmlkZSwgJGh0dHBQcm92aWRlciwgJGNvbXBpbGVQcm92aWRlcikge1xuICAgICAgICB2YXIgZWxlbWVudHNMaXN0ID0gJCgpO1xuICAgICAgICBjb25zb2xlLmxvZygnQWlzbScpO1xuICAgICAgICB2YXIgc2hvd01lc3NhZ2UgPSBmdW5jdGlvbihkYXRhLG1lbnNhamUpIHsgICAgICBcblxuICAgICAgICAgICAgJCgnI21lbnNhamVFcnJvcicpLnRleHQobWVuc2FqZSk7XG4gICAgICAgICAgICAkKCcjcG9wdXBFcnJvcmVzR2xvYmFsZXMnKS5tb2RhbCgnc2hvdycpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQoJyNwb3B1cEVycm9yZXNHbG9iYWxlcycpLm1vZGFsKCdoaWRlJyk7ICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0sMjIwMCk7XG5cbiAgICAgICAgfTtcblxuXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goZnVuY3Rpb24oJHEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG5cbiAgICAgICAgICAgICAgICAncmVzcG9uc2VFcnJvcic6IGZ1bmN0aW9uKHJlamVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTW9sZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlamVjdGlvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVqZWN0aW9uLmRhdGEscmVqZWN0aW9uLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxuICAgICAgICBcbiAgICB9KVxuXG4iLCJISVNMb2dpbi5mYWN0b3J5KCdTZXNzaW9uJywgWyckcmVzb3VyY2UnLCAnJGNvb2tpZVN0b3JlJywgZnVuY3Rpb24gKCRyZXNvdXJjZSwgJGNvb2tpZVN0b3JlKSB7XG5cblx0Ly92YXIgc2VydmljaW9zQmFzZSA9IFwiaHR0cDovLzE5Mi4xNjguMC4zNTo4MDUxXCI7XG5cdHZhciBzZXJ2aWNpb3NCYXNlPVwiaHR0cDovL2xvY2FsaG9zdDo4MDUyXCI7XG5cdC8vdmFyIHNlcnZpY2lvc0Jhc2U9XCJodHRwOi8vYnV5YmFjay5wcm9ub3MucGVcIjtcblx0Ly92YXIgc2VydmljaW9zQmFzZT1cImh0dHA6Ly9idXkucHJvbm9zLnBlOjgwNTJcIjtcblx0Ly92YXIgc2VydmljaW9zQmFzZSA9IFwiaHR0cDovL21hbi5ob2xpbnN5cy5uZXQ6ODA5MVwiO1xuXHQvL3ZhciBzZXJ2aWNpb3NCYXNlID0gXCJodHRwOi8vbWFuLmhvbGluc3lzLm5ldDo4MDUxXCI7XG5cdC8vdmFyIHNlcnZpY2lvc0Jhc2U9XCJodHRwOi8vb2xpbXBvLmhvbGluc3lzLm5ldDo4MDkxXCI7XG5cblx0dmFyIGdldFRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NKV1QnKTtcblxuXHRyZXR1cm4ge1xuXHRcdHVybEJhc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNpb3NCYXNlO1xuICAgICAgICB9LFxuXHRcdGF1dGhVc2VyOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gJHJlc291cmNlKHNlcnZpY2lvc0Jhc2UgKyAnL0hTX0F1dGVudGljYXInLCB7fSwge1xuXHRcdFx0XHR1cGRhdGU6IHtcblx0XHRcdFx0XHRtZXRob2Q6ICdQVVQnXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0fSxcblxuXHRcdHJlY3VwZXJhclBhc3N3b3JkOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gJHJlc291cmNlKHNlcnZpY2lvc0Jhc2UgKyAnL0hTX1VzdWFyaW8vOmlkJywgeyBpZDogJ0BfaWQnIH0sIHtcblx0XHRcdFx0cmVjdXBQYXNzd29yZDogeyB1cmw6IHNlcnZpY2lvc0Jhc2UgKyAnL0hTX1VzdWFyaW8vcmVjdXBlcmFyUHN3ZCcsIG1ldGhvZDogJ1BPU1QnIH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRDYW1iaWFyUHN3ZDogZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRyZXR1cm4gJHJlc291cmNlKHNlcnZpY2lvc0Jhc2UgKyAnL0hTX1VzdWFyaW8vOmlkJywgeyBpZDogJ0BfaWQnIH0sIHtcblx0XHRcdFx0bnVldm9QYXNzd29yZDogeyB1cmw6IHNlcnZpY2lvc0Jhc2UgKyAnL0hTX1VzdWFyaW8vbnVldm9Qc3dkJywgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiBcIkJhc2ljIFwiICsgQmFzZTY0LmVuY29kZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc0pXVCcpKSB9IH0sXG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cdFx0bWVuc2FqZUVudmlvRW1haWw6IGZ1bmN0aW9uIChjYikge1xuXG5cdFx0XHQkKCcjcG9wdXBFbnZpb0VtYWlsJykubW9kYWwoJ3Nob3cnKTtcblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkKCcjcG9wdXBFbnZpb0VtYWlsJykubW9kYWwoJ2hpZGUnKTtcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNiKDIwMCk7XG5cdFx0XHRcdH0sIDgwMCk7XG5cdFx0XHR9LCAyMDAwKTtcblx0XHR9LFxuXHRcdG1lbnNhamVVcGRhdGU6IGZ1bmN0aW9uIChjYikge1xuXG5cdFx0XHQkKCcjcG9wdXBNZW5zYWplc1VwZGF0ZScpLm1vZGFsKCdzaG93Jyk7XG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0JCgnI3BvcHVwTWVuc2FqZXNVcGRhdGUnKS5tb2RhbCgnaGlkZScpO1xuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRyZXR1cm4gY2IoMjAwKTtcblx0XHRcdFx0fSwgODAwKTtcblx0XHRcdH0sIDIwMDApO1xuXHRcdH0sXG5cdFx0bG9nZ2luUHN3ZEluY29ycmVjdG86IGZ1bmN0aW9uICgpIHtcblx0XHRcdCQoJyNwb3B1cERhdG9zSW5jb3JyZWN0b3MnKS5tb2RhbCgnc2hvdycpO1xuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdCQoJyNwb3B1cERhdG9zSW5jb3JyZWN0b3MnKS5tb2RhbCgnaGlkZScpO1xuXHRcdFx0fSwgMzAwMCk7XG5cdFx0fVxuXG5cdH1cbn1dKVxuXG4iLCJ2YXIgSElTQXByb2JhY2lvbmVzRXh0ZXJuYXM9IGFuZ3VsYXIubW9kdWxlKCdISVMuQXByb2JhY2lvbmVzRXh0ZXJuYXMnLCBbXSkiLCJISVNBcHJvYmFjaW9uZXNFeHRlcm5hcy5jb250cm9sbGVyKCdBcHJvYmFjaW9uZXNFeHRlcm5hc0NvbnRyb2xsZXInLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRyb3V0ZVBhcmFtcycsICdBcHJvYmFjaW9uZXNFeHRlcm5hc1NlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsIEFwcm9iYWNpb25lc0V4dGVybmFzU2VydmljZSkge1xuXG4gICAgJHNjb3BlLnJhem9uUmVjaGF6bz1cIiBcIjtcbiAgICAkc2NvcGUuc29saXR1ZFJlc3BvbmRpZGE9ZmFsc2U7XG4gICAgJHNjb3BlLnRpcG9SZXNwdWVzdGEgPSBcIkFwcm9iYWRhXCI7XG4gICAgJHNjb3BlLnNvbGl0dWRFblByb2Nlc289ZmFsc2U7XG4gICAgJHNjb3BlLnNvbGl0dWRFcnJvbmVhID0gZmFsc2U7XG4gICAgJHNjb3BlLmVycm9yUmF6b25SZWNoYXpvPWZhbHNlO1xuICAgICRzY29wZS5pbmdyZXNhclJhem9uUmVjaGF6bz1mYWxzZVxuICAgIGlmKCRyb3V0ZVBhcmFtcy5lc3RhZG89PTApXG4gICAge1xuICAgICAgICAkc2NvcGUuaW5ncmVzYXJSYXpvblJlY2hhem89dHJ1ZVxuICAgIH1cbiAgICBcblxuICAgICRzY29wZS5zb2xpY2l0dWRBcHJvYmFjaW9uPWZ1bmN0aW9uKHRleHRvUmVjaGF6bylcbiAgICB7XG4gICAgICAgICRzY29wZS5zb2xpdHVkRW5Qcm9jZXNvPXRydWVcbiAgICAgICAgXG4gICAgICAgIHZhciBkYXRvc1NvbGljaXR1ZEFwcm9iYWNpb249XG4gICAgICAgIHtcbiAgICAgICAgICAgIGVudGlkYWQ6JHJvdXRlUGFyYW1zLmVudGlkYWQsXG4gICAgICAgICAgICBpZEVudGlkYWQ6JHJvdXRlUGFyYW1zLmlkRW50aWRhZCxcbiAgICAgICAgICAgIGlkVXN1YXJpbzokcm91dGVQYXJhbXMuaWRVc3VhcmlvLFxuICAgICAgICAgICAgaWRTb2xpY2l0dWQ6JHJvdXRlUGFyYW1zLmlkU29saWNpdHVkLFxuICAgICAgICAgICAgZXN0YWRvOiRyb3V0ZVBhcmFtcy5lc3RhZG8gLy9wdWVkZSBzZXIgYXByb2JhZG8gKDEpIG8gcmVjaGF6YXIgKDApXG4gICAgICAgIH1cblxuICAgICAgICBpZih0ZXh0b1JlY2hhem8gIT1cIlwiICYmICRyb3V0ZVBhcmFtcy5lc3RhZG89PTApXG4gICAgICAgIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZGF0b3NTb2xpY2l0dWRBcHJvYmFjaW9uLnJhem9uUmVjaGF6bz0gdGV4dG9SZWNoYXpvXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzSldURXh0ZXJubycsICRyb3V0ZVBhcmFtcy50b2tlbmp3dCk7ICAgICBcbiAgICAgICAgQXByb2JhY2lvbmVzRXh0ZXJuYXNTZXJ2aWNlLnJlc3BvbmRlclNvbGljaXR1ZCgpLnNhdmUoZGF0b3NTb2xpY2l0dWRBcHJvYmFjaW9uLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkc2NvcGUuc29saXR1ZEVuUHJvY2Vzbz1mYWxzZVxuICAgICAgICAgICAgJHNjb3BlLnNvbGl0dWRSZXNwb25kaWRhPXRydWVcblxuICAgICAgICAgICAgJHNjb3BlLmVycm9yUmF6b25SZWNoYXpvPWZhbHNlXG4gICAgICAgICAgICAkc2NvcGUuaW5ncmVzYXJSYXpvblJlY2hhem89ZmFsc2VcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwic0pXVEV4dGVybm9cIik7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICRzY29wZS5lcnJvclJlc3B1ZXN0YSAgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7ICAgICAgICAgICAgXG4gICAgICAgICAgICAgJHNjb3BlLnNvbGl0dWRFcnJvbmVhID0gdHJ1ZTsgICBcbiAgICAgICAgICAgICAkc2NvcGUuc29saXR1ZEVuUHJvY2Vzbz1mYWxzZTtcbiAgICAgICAgICAgICAkc2NvcGUuZXJyb3JSYXpvblJlY2hhem89ZmFsc2VcbiAgICAgICAgICAgICAkc2NvcGUuaW5ncmVzYXJSYXpvblJlY2hhem89ZmFsc2VcbiAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcInNKV1RFeHRlcm5vXCIpO1xuICAgICAgICAgICAgIC8qaWYocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcblxuICAgICAgICAgICAgIH0gKi8gIFxuXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYoJHJvdXRlUGFyYW1zLmVzdGFkbz09MSlcbiAgICB7XG4gICAgICAgJHNjb3BlLnNvbGljaXR1ZEFwcm9iYWNpb24oXCJcIilcbiAgICB9XG5cbiAgICAkc2NvcGUucmVjaGF6YXJTb2xpY2l0dWQ9ZnVuY3Rpb24odGV4dG9SZWNoYXpvKVxuICAgIHtcbiAgICAgICAgXG4gICAgICAgIGlmKHRleHRvUmVjaGF6byAhPVwiIFwiICYmIHRleHRvUmVjaGF6byAhPVwiXCIgJiYgdGV4dG9SZWNoYXpvKVxuICAgICAgICB7XG4gICAgICAgICAgICAkc2NvcGUudGlwb1Jlc3B1ZXN0YSA9IFwiUmVjaGF6YWRhXCI7XG5cbiAgICAgICAgICAgICRzY29wZS5zb2xpY2l0dWRBcHJvYmFjaW9uKHRleHRvUmVjaGF6bylcblxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JSYXpvblJlY2hhem89dHJ1ZVxuICAgICAgICB9XG4gICAgfVxuXG59XSkiLCJISVNBcHJvYmFjaW9uZXNFeHRlcm5hcy5mYWN0b3J5KCdBcHJvYmFjaW9uZXNFeHRlcm5hc1NlcnZpY2UnLFsnJHJlc291cmNlJywnJHEnLCckaHR0cCcsJ1Nlc3Npb24nLGZ1bmN0aW9uKCRyZXNvdXJjZSwkcSwkaHR0cCxTZXNzaW9uKXtcbiAgICByZXR1cm57XG5cdFx0cmVzcG9uZGVyU29saWNpdHVkOmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gJHJlc291cmNlKFNlc3Npb24udXJsQmFzZSgpICsgJy9hcHJvYmFjaW9uZXNFeHRlcm5hcy86aWQnLCB7IGlkOiAnQF9pZCcgfSwge1x0XG5cdFx0XHQgIFxuXHRcdFx0ICBcdHNhdmU6ICAgIHsgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgJ0F1dGhvcml6YXRpb24nOiBcIkJhc2ljIFwiICsgQmFzZTY0LmVuY29kZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc0pXVEV4dGVybm8nKSkgIH0gfSxcdFxuXHRcdFx0XHQgICAgICAgICAgICAgICAgICAgICAgICBcblx0XHQgIFx0fSk7XG5cdFx0XG5cdFx0fSxcblx0XHRcblxufVxuXG59XSk7Il19
